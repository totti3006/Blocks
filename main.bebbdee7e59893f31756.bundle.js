/*! For license information please see main.bebbdee7e59893f31756.bundle.js.LICENSE.txt */
(()=>{var e,t={831:(e,t,s)=>{"use strict";s(260);class i extends Phaser.Scene{constructor(){super({key:"BootScene"})}preload(){this.cameras.main.setBackgroundColor(0),this.createLoadingGraphics(),this.load.on("progress",(e=>{this.progressBar.clear(),this.progressBar.fillStyle(8971347,1),this.progressBar.fillRect(this.cameras.main.width/4,this.cameras.main.height/2-16,this.cameras.main.width/2*e,16)}),this),this.load.on("complete",(()=>{this.progressBar.destroy(),this.loadingBar.destroy()}),this),this.load.pack("preload","./assets/pack.json","preload")}update(){this.scene.start("GameScene")}createLoadingGraphics(){this.loadingBar=this.add.graphics(),this.loadingBar.fillStyle(16777215,1),this.loadingBar.fillRect(this.cameras.main.width/4-2,this.cameras.main.height/2-18,this.cameras.main.width/2+4,20),this.progressBar=this.add.graphics()}}let r={currentLevel:0,tileSize:16,levels:[{width:10,height:9,cursorStart:[3,3],data:[[1,1,1,1,1,1,1,1,1,1],[1,0,0,0,1,1,1,1,1,1],[1,0,0,0,0,0,0,1,1,1],[1,0,0,0,0,3,0,1,1,1],[1,0,0,0,0,2,0,1,1,1],[1,0,0,3,2,4,3,1,1,1],[1,0,4,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1]]}]};const a=class{constructor(e){this.source=e,this.scene=e.scene,this.initEmitter(e.getColor()),this.createExplodeEmitter(),this.createScaleTween(),this.createJumpTween()}initEmitter(e){this.explodeEmitterManager=this.scene.add.particles(e)}createScaleTween(){this.scaleTween=this.scene.add.tween({targets:this.source,scale:1.8,duration:600,repeat:0,ease:"Sine.easeInOut",paused:!0,onComplete:()=>{this.source.setScale(1)}})}createJumpTween(){this.jumpTween=this.scene.add.tween({targets:this.source,y:{from:this.source.y,to:this.source.y-3},duration:100,yoyo:!0,repeat:0,paused:!0})}createExplodeEmitter(){this.explodeEmitter=this.explodeEmitterManager.createEmitter({speed:{min:100,max:150},angle:{start:0,end:360,steps:10},scale:{start:.1,end:0},lifespan:300,blendMode:"ADD",on:!1})}playExplodeEmitter(){let e=this.source.x,t=this.source.y;this.explodeEmitter.explode(10,e,t)}playScale(){this.scaleTween.play()}playJump(){this.jumpTween.play()}};class n extends Phaser.GameObjects.Sprite{constructor(e){super(e.scene,e.x,e.y,e.texture,e.type),this.blockType=e.type,this.isDying=!1,this.isScaling=!1,this.animation=new a(this),this.initSprite(),this.scene.add.existing(this)}update(){this.isDying&&(this.alpha-=.02,this.isScaling||(this.isScaling=!0,this.animation.playScale()),0===this.alpha&&(this.animation.playExplodeEmitter(),this.isDying=!1,this.isScaling=!1,this.setType(0),this.setAlpha(1)))}initSprite(){this.setFrame(this.blockType),this.setOrigin(.5,.5)}getType(){return this.blockType}setType(e){this.blockType=e,this.setFrame(this.blockType)}activateDead(){this.isDying=!0}getDead(){return this.isDying}getColor(){let e=this.getType();return 2===e?"red":3===e?"blue":"green"}playScaleAnimation(){this.animation.playScale()}playJumpAnimation(){this.animation.playJump()}resetAnimation(){this.animation=new a(this)}}class o extends Phaser.GameObjects.Image{constructor(e){super(e.scene,e.x,e.y,e.texture,e.cursorStartPosition),this.currentPosition=e.cursorStartPosition,this.initVariables(),this.initImage(),this.scene.add.existing(this),this.animation=new class{constructor(e){this.source=e,this.scene=e.scene,this.createScaleTween()}createScaleTween(){this.scaleTween=this.scene.add.tween({targets:this.source,scale:.9,duration:200,yoyo:!0,repeat:-1,ease:"Sine.easeInOut",paused:!0,onStop:()=>{this.source.setScale(1)}})}playScaleAnimation(){this.scaleTween.play()}stopScaleAnimation(){this.scaleTween.stop()}}(this)}initVariables(){this.activated=!1}initImage(){this.setOrigin(.5,.5)}moveTo(e,t){this.currentPosition=[e,t],this.setPosition(e*r.tileSize+.5*r.tileSize,t*r.tileSize+.5*r.tileSize)}getX(){return this.currentPosition[0]}getY(){return this.currentPosition[1]}isActivated(){return this.activated}setActivated(){this.activated=!this.activated,this.activated?this.animation.playScaleAnimation():this.animation.stopScaleAnimation()}}class c extends Phaser.Scene{constructor(){super({key:"GameScene"}),this.currentLevelArray=[]}init(){let e=r.levels[r.currentLevel];this.currentLevelWidth=e.width,this.currentLevelHeight=e.height;for(let t=0;t<this.currentLevelHeight;t++)for(let s=0;s<this.currentLevelWidth;s++){let i=e.data[t][s];this.currentLevelArray.push(new n({scene:this,x:s*r.tileSize+.5*r.tileSize,y:t*r.tileSize+.5*r.tileSize,texture:"block",type:i}))}this.cursors=this.input.keyboard.createCursorKeys(),this.actionKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.cursor=new o({scene:this,x:r.levels[r.currentLevel].cursorStart[0]*r.tileSize+.5*r.tileSize,y:r.levels[r.currentLevel].cursorStart[1]*r.tileSize+.5*r.tileSize,texture:"cursor",cursorStartPosition:r.levels[r.currentLevel].cursorStart})}update(){for(let e=this.currentLevelHeight-1;e>=0;e--)for(let t=this.currentLevelWidth-1;t>=0;t--){let s=this.currentLevelArray[this.getBlockIndex(t,e)];if(s.getDead())s.update();else{let i;i=e>0?this.currentLevelArray[this.getBlockIndex(t,e-1)]:void 0,0===s.getType()&&void 0!==i&&i.getType()>1&&this.swapTwoBlocks(this.getBlockIndex(t,e),this.getBlockIndex(t,e-1))}}this.checkMatches(),this.handleInput()}handleInput(){let e=this.cursor.getX(),t=this.cursor.getY(),s=0,i=0;if(Phaser.Input.Keyboard.JustDown(this.cursors.right)?s=1:Phaser.Input.Keyboard.JustDown(this.cursors.left)&&(s=-1),this.cursor.isActivated()||(Phaser.Input.Keyboard.JustDown(this.cursors.up)?i=-1:Phaser.Input.Keyboard.JustDown(this.cursors.down)&&(i=1)),0!==s||0!==i){let r=e+s,a=t+i;1!==this.getBlockType(r,a)&&(this.cursor.moveTo(r,a),this.getBlock(r,a).playJumpAnimation(),this.cursor.isActivated()&&(this.swapTwoBlocks(this.getBlockIndex(e,t),this.getBlockIndex(r,a)),this.cursor.setActivated()))}Phaser.Input.Keyboard.JustDown(this.actionKey)&&0!==this.getBlockType(this.cursor.getX(),this.cursor.getY())&&this.cursor.setActivated()}getBlock(e,t){return this.currentLevelArray[t*this.currentLevelWidth+e]}getBlockIndex(e,t){return t*this.currentLevelWidth+e}getBlockType(e,t){return this.currentLevelArray[t*this.currentLevelWidth+e].getType()}getBlockTypeById(e){return this.currentLevelArray[e].getType()}swapTwoBlocks(e,t){let s=this.getBlockTypeById(e),i=this.getBlockTypeById(t);this.currentLevelArray[e].setType(i),this.currentLevelArray[t].setType(s),this.currentLevelArray[e].resetAnimation(),this.currentLevelArray[t].resetAnimation()}checkMatches(){let e=[];for(let t=1;t<this.currentLevelHeight-1;t++)for(let s=1;s<this.currentLevelWidth-1;s++)this.getBlockType(s,t)>1&&this.isSameTypeAroundMe(s,t)&&e.push(this.getBlockIndex(s,t));for(let t=0;t<e.length;t++)this.currentLevelArray[e[t]].activateDead()}isSameTypeAroundMe(e,t){let s=this.getBlockType(e,t),i=this.getBlockType(e-1,t),r=this.getBlockType(e+1,t),a=this.getBlockType(e,t-1),n=this.getBlockType(e,t+1);return s===i||s===r||s===a||s===n}}const h={title:"Blocks",url:"https://github.com/digitsensitive/phaser3-typescript",version:"1.0",width:160,height:144,zoom:3,type:Phaser.AUTO,parent:"game",scene:[i,c],backgroundColor:"#24232e",render:{pixelArt:!0,antialias:!1}};class l extends Phaser.Game{constructor(e){super(e)}}window.addEventListener("load",(()=>{new l(h)}))},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(e){var r=s[e];if(void 0!==r)return r.exports;var a=s[e]={exports:{}};return t[e].call(a.exports,a,a.exports,i),a.exports}i.m=t,e=[],i.O=(t,s,r,a)=>{if(!s){var n=1/0;for(l=0;l<e.length;l++){for(var[s,r,a]=e[l],o=!0,c=0;c<s.length;c++)(!1&a||n>=a)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(o=!1,a<n&&(n=a));if(o){e.splice(l--,1);var h=r();void 0!==h&&(t=h)}}return t}a=a||0;for(var l=e.length;l>0&&e[l-1][2]>a;l--)e[l]=e[l-1];e[l]=[s,r,a]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var r,a,[n,o,c]=s,h=0;if(n.some((t=>0!==e[t]))){for(r in o)i.o(o,r)&&(i.m[r]=o[r]);if(c)var l=c(i)}for(t&&t(s);h<n.length;h++)a=n[h],i.o(e,a)&&e[a]&&e[a][0](),e[a]=0;return i.O(l)},s=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(831)));var r=i.O(void 0,[216],(()=>i(204)));r=i.O(r)})();